<!DOCTYPE html>
<html lang="en">


<!-- molla/dashboard.html  22 Nov 2019 10:03:13 GMT -->
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Urban Charms</title>
    <meta name="keywords" content="HTML5 Template">
    <meta name="description" content="Molla - Bootstrap eCommerce Template">
    <meta name="author" content="p-themes">
    <!-- Favicon -->
    <link rel="apple-touch-icon" sizes="180x180" href="/assetsb/images/icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/assetsb/images/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/assetsb/images/icons/favicon-16x16.png">
    <link rel="manifest" href="/assetsb/images/icons/site.html">
    <link rel="mask-icon" href="/assetsb/images/icons/safari-pinned-tab.svg" color="#666666">
    <link rel="shortcut icon" href="/assetsb/images/icons/favicon.ico">
    <meta name="apple-mobile-web-app-title" content="Molla">
    <meta name="application-name" content="Molla">
    <meta name="msapplication-TileColor" content="#cc9966">
    <meta name="msapplication-config" content="/assetsb/images/icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <!-- Plugins CSS File -->
    <link rel="stylesheet" href="/assetsb/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <!-- Main CSS File -->
    <link rel="stylesheet" href="/assetsb/css/style.css">
    <style>
    /* wallet style */
/* Styles for wallet container */
.wallet-container {
    margin-top: 20px;
    width: 80%; /* Adjust width as needed */
    margin: 0 auto; /* Center the wallet container */
    overflow: hidden; /* Hide overflow for smoother animation */
    background-color: #f0f0f0;
    padding: 15px;
    border-radius: 5px;
}

/* Styles for amount box */
.amount-box {
    background-color: #f0f0f0;
    padding: 20px;
  
    
}

.amount-box img {
    width: 100px;
    margin-bottom: 10px;
}

.amount-box p {
    margin: 0;
    font-size: 18px;
    color: #333;
}

.amount {
    font-size: 24px;
    font-weight: bold;
    color: #007bff;
}

.referral-box {
        border: 1px solid #ccc;
        border-radius: 5px;
        padding: 20px;
        margin-bottom: 20px;
    }
    .welcome-message {
        margin-bottom: 10px;
    }
    .username {
        font-weight: bold;
    }
    .referral-code-container {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 10px;
    }
    .referral-code {
        display: flex;
        align-items: center;
    }
    .referral-code span {
        margin-right: 10px;
    }
    .dashboard-actions {
        margin-top: 20px;
    }
/* Styles for buttons */
.btn-group {
    margin-top: 20px;
}

.btn-outline-light {
    border: 2px solid #007bff;
    color: #007bff;
    transition: all 0.3s ease;
}

.btn-outline-light:hover {
    background-color: #007bff;
    color: #fff;
}

/* Styles for transaction history */
.txn-history {
    margin-top: 20px;
    overflow-y: auto; /* Enable vertical scroll */
    max-height: 200px; /* Adjust max-height as needed */
}

.txn-list {
    margin: 0;
    padding: 10px 0;
    border-bottom: 1px solid #ccc;
    font-size: 16px;
}
#add-money-btn:hover{
    background-color:  #c96;
    border: none;
    color: white;
}
#add-money-input{
border-radius: 10px;
}
.debit-amount {
    color: #dc3545;
    margin-left: auto;
}

.credit-amount {
    color: #28a745;
    margin-left: auto;
}

/* Styles for scrollbar */
.txn-history::-webkit-scrollbar {
    width: 10px;
}

.txn-history::-webkit-scrollbar-thumb {
    background-color:  #c96f;
    border-radius: 10px;
}

.txn-history::-webkit-scrollbar-track {
    background-color: #f0f0f0;
}


              /* Modified CSS styles for black and white combo and circular design */
              .pagination {
            display: flex;
            justify-content: center;
            list-style: none;
            padding: 10px;
            margin-top: 20px;
        }
    
        .pagination a {
            color: black;
            background-color: white;
            border: 1px solid black; /* Set the border color to black */
            border-radius: 40%; /* Make it circular */
            text-align: center;
            width: 30px; /* Set a fixed width for circular shape */
            height: 30px; /* Set a fixed height for circular shape */
            line-height: 30px; /* Center text vertically */
            text-decoration: none;
            transition: background-color 0.3s, color 0.3s;
            display: inline-block;
            margin: 0 5px;
            font-weight: bold; /* Ensure visibility of text */
        }
    
        .pagination a.active {
            background-color: black;
            color: white;
            border-color: #000;
        }
    
        /* Styles for Prev and Next buttons */
        .pagination a.prev,
        .pagination a.next {
            background-color: white;
            color: black;
            border-color: black;
            border-radius: 30%; /* Make it circular */
            width: 50px; /* Set a fixed width for circular shape */
            height: 30px; /* Set a fixed height for circular shape */
        }
    
        .pagination a.prev:hover,
        .pagination a.next:hover {
            background-color: black;
            color: #fff;
            border-color: black;
        }
        textarea.form-control {
            height: 100px;
            resize: vertical;
        }
        .alert-message {
  color: red;
  margin-bottom: 10px;
}
.styled-table {
    border-collapse: collapse;
    width: 100%;
}

.styled-table th, .styled-table td {
    padding: 8px;
}

.table-row {
    margin-bottom: 4px;
}
/* Add this CSS to your existing styles */


/* Button style */
.btn {
    
    transition: background-color 0.3s ease, transform 0.3s ease;
}

.btn-info {
    background-color: white;
    border: 1px solid #c96;
    color:#c96;
}

.btn-danger {
    background-color: #e74c3c;
    color: #fff;
    border-radius: 3px;
}

/* Hover effect */
.btn:hover {
    background-color: #c96;
    transform: scale(1.05);
    border:none;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    border: 1px solid #c96;
}



.cancel-btn:hover {
    background-color: #c0392b;
    transform: scale(1.05);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
}

        /* Add your existing styles here */
        .error {
            color: #dc3545; /* Red color for the text */
        }

        .error {
            color: #dc3545; /* Red color for error messages */
        }
    
      
    </style>
</head>

<body>
    <div class="page-wrapper">

<!-- header start -->

<%- include('../userpartials/header.ejs')%>
        <!-- End .header -->

        <main class="main">
        	<div class="page-header text-center" style="background-image: url('/assetsb/images/page-header-bg.jpg')">
        		<div class="container">
        			<h1 class="page-title">My Account<span>Shop</span></h1>
        		</div><!-- End .container -->
        	</div><!-- End .page-header -->
            <nav aria-label="breadcrumb" class="breadcrumb-nav mb-3">
                <div class="container">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="/">Home</a></li>
                        <li class="breadcrumb-item"><a href="category">Shop</a></li>
                        <li class="breadcrumb-item active" aria-current="page">My Account</li>
                    </ol>
                </div><!-- End .container -->
            </nav><!-- End .breadcrumb-nav -->

            <div class="page-content">
            	<div class="dashboard">
	                <div class="container">
	                	<div class="row">
	                		<aside class="col-md-4 col-lg-3">
	                			<ul class="nav nav-dashboard flex-column mb-3 mb-md-0" role="tablist">
								    <li class="nav-item">
								        <a class="nav-link active" id="tab-dashboard-link" data-toggle="tab" href="#tab-dashboard" role="tab" aria-controls="tab-dashboard" aria-selected="true">Dashboard</a>
								    </li>
								    <li class="nav-item">
								        <a class="nav-link" id="tab-orders-link" data-toggle="tab" href="#tab-orders" role="tab" aria-controls="tab-orders" aria-selected="false">Orders</a>
								    </li>
                                    <li class="nav-item">
								        <a class="nav-link" id="tab-address-link" data-toggle="tab" href="#tab-editaccount" role="tab" aria-controls="tab-address" aria-selected="false">Edit Account</a>
								    </li>
								    <li class="nav-item">
								        <a class="nav-link" id="tab-downloads-link" data-toggle="tab" href="#tab-downloads" role="tab" aria-controls="tab-downloads" aria-selected="false">Add Address</a>
								    </li>
                                   
								    <li class="nav-item">
								        <a class="nav-link" id="tab-address-link" data-toggle="tab" href="#tab-address" role="tab" aria-controls="tab-address" aria-selected="false">Adresses</a>
								    </li>
								 <li class="nav-item">
								      <a class="nav-link" id="tab-account-link" data-toggle="tab" href="#tab-account" role="tab" aria-controls="tab-account" aria-selected="false">Wallet</a>
								 </li>
                                    <li class="nav-item">
                                         <a id="signOutLink" class="nav-link" href="/changepassword">Change password</a>
                                    </li>
								    <li class="nav-item">
								        <a class="nav-link" href="/logout">Sign Out</a>
								    </li>
								</ul>
	                		</aside><!-- End .col-lg-3 -->

	                		<div class="col-md-8 col-lg-9">
                                
	                			<div class="tab-content">
                                    <% if (datas !== null && datas !== undefined) { %>
                                        <div class="tab-pane fade show active" id="tab-dashboard" role="tabpanel" aria-labelledby="tab-dashboard-link">
                                            <div class="referral-box">
                                                <p class="welcome-message">
                                                    Hello 
                                                    <% if (datas && datas.username) { %>
                                                        <span class="username"><%= datas.username %></span>
                                                    <% } else { %>
                                                        <span class="username">Guest</span>
                                                    <% } %>
                                                </p>
                                                <div class="referral-code-container">
                                                    <p>Your referral code:</p>
                                                    <div class="referral-code">
                                                        <span id="referralCode" class="font-weight-normal text-dark"><%= datas.referralCode %></span>
                                                        <button onclick="copyReferralCode()" class="btn btn-primary btn-sm">Copy</button>
                                                    </div>
                                                </div>
                                                <p class="dashboard-actions">From your account dashboard you can view your <a href="#tab-orders" class="tab-trigger-link link-underline">recent orders</a>, manage your <a href="#tab-address" class="tab-trigger-link">shipping and billing addresses</a> (<a href="logout">Log out</a>)</p>
                                            </div>
                                        </div><!-- .End .tab-pane -->
                                    <% } else { %>
                                        <p>No user found.</p>
                                    <% } %>
                                    
                                    <div class="tab-pane fade" id="tab-orders" role="tabpanel" aria-labelledby="tab-orders-link">
                                        <div class="table-responsive table-product">
                                            <div class="container-fluid">
                                                <table class="table styled-table" id="table_id">
                                                    <thead>
                                           
                                                        
                                                        <% if (orders !== null && orders !== undefined) { %>
                                                        <tr>
                                                            <th>OrderId</th>
                                                            <th>Total</th>
                                                         <th>Date</th>
                                                            <th>Status</th>
                                                            <th>Details</th>
                                                            <th>Cancel Orders</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        
                                                        <% orders.slice().reverse().forEach((finder) => { %>
                                                            <% finder.products.slice().reverse().forEach((product) => { %>
                                                                <tr>
                                                                    <td><%= product.productId.productname %></td>
                                                                    <td>₹<%= product.total + 120 %></td>   
                                                                    <td><%= formatDate(finder.date) %></td>
                                                                    <td><%= product.Status %></td>
                                                                    <td>
                                                                        <a href="/orderdetails/<%= finder.orderId %>?productid=<%= product.productId._id %>" class="btn btn-info btn-sm">View Details</a>
                                                                    </td>
                                                                    <td>
                                                                        <% if (product.Status === 'Delivered') { %>
                                                                            <strong style="color: green;">Delivered</strong>
                                                                        <% } else  if (product.Status === 'cancelled') { %> <!-- Check product cancelStatus -->
                                                                            <strong style="color: red; font-style: italic;">Cancelled</strong>
                                                                        <% } else { %>
                                                                            <% if (product.Status !== 'Delivered' && product.Status !== 'Cancelled') { %>
                                                                                <% if (product.Status !== 'cancelled') { %>
                                                                                    <!-- Enable the button if order status allows cancellation -->
                                                                                    <button class="btn btn-danger btn-sm cancel-btn" onclick="cancelOrder('<%= finder._id %>', '<%= product.productId._id %>')">Cancel</button>
                                                                                <% } %>
                                                                            <% } %>
                                                                        <% } %>
                                                                    </td>
                                                                </tr>
                                                            <% }); %>
                                                        <% }); %>
                                                        <% } else { %>
                                                           <p>no orders found</p>
                                                        <% } %>
                                                    </tbody>
                                                </table>
                                          
                                                <!-- Pagination -->
                                               
                                                <div class="pagination" id="pagination">
                                                    <% if (currentPage !== null && currentPage !== undefined && currentPage >=1) { %>
                                                    <% if (currentPage > 1) { %>
                                                        <a href="/profile?page=<%= currentPage - 1 %>" class="prev">Prev</a>
                                                    <% } %>
                                            
                                                    <% if (currentPage > 3) { %>
                                                        <a href="/profile?page=1">1</a>
                                                        <% if (currentPage > 4) { %>
                                                            <span>...</span>
                                                        <% } %>
                                                    <% } %>
                                            
                                                    <% for (let i = Math.max(1, currentPage - 1); i <= Math.min(totalPages, currentPage + 1); i++) { %>
                                                        <a href="/profile?page=<%= i %>" class="<%= currentPage === i ? 'active' : '' %>"><%= i %></a>
                                                    <% } %>
                                            
                                                    <% if (currentPage < totalPages - 2) { %>
                                                        <% if (currentPage < totalPages - 3) { %>
                                                            <span>...</span>
                                                        <% } %>
                                                    <% } %>
                                            
                                                    <% if (currentPage < totalPages) { %>
                                                        <a href="/profile?page=<%= currentPage + 1 %>" class="next">Next</a>
                                                    <% } %>
                                                    <% } else { %>
                                                        <!-- Handle the case when currentPage is null, undefined, or less than or equal to 1 -->
                                                        <span class="disabled">Prev</span>
                                                    <% } %>
                                                </div>
                                             
                                            </div>
                                            
                                            <% function formatDate(date) {
                                                const options = { year: 'numeric', month: 'short', day: 'numeric' };
                                                return new Date(date).toLocaleDateString(undefined, options);
                                            } %>
                                        </div>
                                    </div>
                                    
                                    
                                    <div class="tab-pane fade" id="tab-editaccount" role="tabpanel" aria-labelledby="tab-downloads-link">
                                        <% if (datas !== null && datas !== undefined ) { %>
                                        <form action="/editaccount" method="POST">
                                            <% if (alertMessage) { %>
                                                <div id="alert" class="alert-message">
                                                    <%= alertMessage %>
                                                </div>
                                                <script>
                                                    document.addEventListener('input', function (event) {
                                                        var alertDiv = document.getElementById('alert');
                                                        if (alertDiv) {
                                                            alertDiv.style.display = 'none';
                                                        }
                                                    });
                                                </script>
                                            <% } %>
                                            <div class="row">
                                                <div class="col-sm-12">
                                                    <label>Username *</label>
                                                    <input type="text" class="form-control" name="username" value="<%= datas.username %>">
                                                </div><!-- End .col-sm-6 -->
                                    
                                                <div class="col-sm-12">
                                                    <label>Email *</label>
                                                    <input type="email" class="form-control" name="email" value="<%= datas.email %>">
                                                </div><!-- End .col-sm-6 -->
                                            </div><!-- End .row -->
                                    
                                            <label>Phone Number *</label>
                                            <input type="tel" class="form-control" name="phoneNumber" value="<%= datas.phone %>" >
                                    
                                            <!-- Other existing fields -->
                                    
                                            <button type="submit" class="btn btn-outline-primary-2">
                                                <span>Save</span>
                                                <i class="icon-long-arrow-right"></i>
                                            </button>
                                        </form>
                                        <% } else { %>
                                            <p>No user found.</p>
                                        <% } %>
                                    </div><!-- .End .tab-pane -->
                                    
                                     <!-- Existing code... -->
                                     <div class="tab-pane fade" id="tab-downloads" role="tabpanel" aria-labelledby="tab-downloads-link">
                                        <form action="/add-address" method="POST" onsubmit="return validateForm()">
                                            <% if (alertMessage) { %>
                                                <div id="alert" class="alert-message" style="color: red;">
                                                    <%= alertMessage %>
                                                </div>
                                                <script>
                                                    document.addEventListener('input', function (event) {
                                                        var alertDiv = document.getElementById('alert');
                                                        if (alertDiv) {
                                                            alertDiv.style.display = 'none';
                                                        }
                                                    });
                                                </script>
                                            <% } %>
                                        
                                            <div class="row">
                                                <div class="col-sm-6">
                                                    <label>First Name *</label>
                                                    <input type="text" class="form-control" name="firstName" id="firstName" oninput="validateField('firstName')">
                                                    <span id="firstNameError" class="error"></span>
                                                </div><!-- End .col-sm-6 -->
                                        
                                                <div class="col-sm-6">
                                                    <label>Last Name *</label>
                                                    <input type="text" class="form-control" name="lastName" id="lastName" oninput="validateField('lastName')">
                                                    <span id="lastNameError" class="error"></span>
                                                </div><!-- End .col-sm-6 -->
                                            </div><!-- End .row -->
                                        
                                            <div class="col-sm-12">
                                                <label>Address *</label>
                                                <textarea class="form-control" name="address" id="address" rows="4" oninput="validateField('address')"></textarea>
                                                <span id="addressError" class="error"></span>
                                            </div><!-- End .col-sm-6 -->
                                        
                                            <label>Phone Number *</label>
                                            <input type="tel" class="form-control" name="phoneNumber" id="phoneNumber" oninput="validateField('phoneNumber')" pattern="[0-9]*">
                                            <span id="phoneNumberError" class="error"></span>
                                        
                                            <div class="row">
                                                <div class="col-sm-6">
                                                    <label>Pincode *</label>
                                                    <input type="text" class="form-control" name="pincode" id="pincode" oninput="validateField('pincode')" pattern="[0-9]*">
                                                    <span id="pincodeError" class="error"></span>
                                                </div><!-- End .col-sm-6 -->
                                        
                                                <div class="col-sm-6">
                                                    <label>City/District *</label>
                                                    <input type="text" class="form-control" name="city" id="city" oninput="validateField('city')">
                                                    <span id="cityError" class="error"></span>
                                                </div><!-- End .col-sm-6 -->
                                            </div><!-- End .row -->
                                        
                                            <label>State *</label>
                                            <input type="text" class="form-control" name="state" id="state" oninput="validateField('state')">
                                            <span id="stateError" class="error"></span>
                                        
                                            <!-- Other existing fields -->
                                        
                                            <button type="submit" class="btn btn-outline-primary-2">
                                                <span>Save</span>
                                                <i class="icon-long-arrow-right"></i>
                                            </button>
                                        </form>
                                        
                                    </div><!-- .End .tab-pane -->
                                    

                                    <div class="tab-pane fade" id="tab-address" role="tabpanel" aria-labelledby="tab-address-link">
                                       <div class="col-12">
                                  
                                    </div>
                                        <div class="row">
                                            <% if (address !== null && address !== undefined &&  address.addresses.length > 0) { %>
                                                <% address.addresses.forEach((details) => { %>
                                                    <div class="col-lg-6">
                                                        <div class="card card-dashboard">
                                                            <div class="card-body">
                                                                <!-- End .card-title -->
                                                                    <h5><%= details.firstName %>  <%= details.lastName %></h5>
                                                                                               
                                                                 <p>
                                                                   
                                                                   
                                                                   <%= details.phoneNumber %><br>
                                                                   <%= details.city %> , <%= details.pincode %> , <%= details.state %><br>
                                                                   <%= details.address %><br>
                                                                   <a href="/editaddress?id=<%=details._id%>">Edit <i class="icon-edit"></i></a>     
                                                                   <a href="javascript:void(0);" onclick="deleteAddress('<%= details._id %>')" style="margin-left: 250px;">
                                                                    <!-- Add sweet alert for this before it's get deleted -->
                                                                 
                                                               
                                                                
                                                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash" viewBox="0 0 16 16">
                                                                        <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0z"/>
                                                                        <path d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4zM2.5 3h11V2h-11z"/>
                                                                      </svg>
                                                                  </a>
                                                                </p>
                                                               
                                                                
                                                            </div><!-- End .card-body -->
                                                        </div><!-- End .card-dashboard -->
                                                    </div><!-- End .col-lg-6 -->
                                                <% }); %>
                                            <% } else { %>
                                                <p>No addresses found.</p>
                                            <% } %>
                                        </div>
                                    </div>
                                    

                                    <div class="tab-pane fade" id="tab-account" role="tabpanel" aria-labelledby="tab-account-link">
                                        <div class="wallet-container text-center">
                                            <% if (wallet!== null && wallet !== undefined) { %>
                                                <div class="amount-box text-center">
                                                    <img style="width: 60px;" src="https://lh3.googleusercontent.com/ohLHGNvMvQjOcmRpL4rjS3YQlcpO0D_80jJpJ-QA7-fQln9p3n7BAnqu3mxQ6kI4Sw" alt="wallet">
                                                    <p>Total Balance</p>
                                                    <p class="amount">$ <%= wallet.balance %></p> <!-- Display total balance from the wallet data -->
                                                </div>
                                                <div class="btn-group text-center">
                                                    <input type="number" class="form-control" id="add-money-input" placeholder="Enter amount to add">
                                                    <button type="button" style="width: 204px; height: 43px;margin-left: 13px; border-radius: 16px;" id="add-money-btn">Add</button>
                                                </div>
                                                
                                                <p><b>Transactions</b></p>
                                                <div class="txn-history">
                                                    <% if (wallet.transactions.length > 0) { %>
                                                        <% wallet.transactions.slice().reverse().forEach(transaction => { %>
                                                            <p class="txn-list"><%= transaction.description %><span class="<%= transaction.amount < 0 ? 'debit-amount' : 'credit-amount' %>">$<%= Math.abs(transaction.amount) %></span></p>
                                                        <% }); %>
                                                    <% } else { %>
                                                        <p>No transactions available</p> <!-- Display message if no transactions -->
                                                    <% } %>
                                                </div>
                                            <% } else { %>
                                                <p>No wallet data available</p> <!-- Display message if wallet data is null or undefined -->
                                            <% } %>
                                        </div>
                                    </div>
                                    
                                    
								</div>
	                		</div><!-- End .col-lg-9 -->
	                	</div><!-- End .row -->
	                </div><!-- End .container -->
                </div><!-- End .dashboard -->
            </div><!-- End .page-content -->
        </main><!-- End .main -->

      <!-- footer start -->
      <%- include('../userpartials/footer.ejs')%>
      <!-- footer ends -->
      <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
      <script>
        function copyReferralCode() {
            // Get the referral code element
            var referralCodeElement = document.getElementById("referralCode");
    
            // Create a temporary textarea element to copy the referral code
            var tempTextarea = document.createElement("textarea");
            tempTextarea.value = referralCodeElement.innerText;
    
            // Append the textarea to the body
            document.body.appendChild(tempTextarea);
    
            // Select the referral code text
            tempTextarea.select();
            tempTextarea.setSelectionRange(0, 99999); // For mobile devices
    
            // Copy the referral code to the clipboard
            document.execCommand("copy");
    
            // Remove the temporary textarea
            document.body.removeChild(tempTextarea);
    
            // Show a success message (optional)
            Swal.fire({
                    icon: 'success',
                    title: 'Copied  successfully!',
                    text: 'Refferal Copied successfully'
                });
        }
    </script>
      <script>

        //delete address

        async function deleteAddress(addressId) {
    const result = await Swal.fire({
        title: 'Are you sure?',
        text: 'Are you sure you want to delete this address?',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonText: 'Yes, delete it!',
        cancelButtonText: 'Cancel',
        reverseButtons: true
    });
    
    if (result.isConfirmed) {
                try {
                    const response = await fetch(`/deleteaddress/${addressId}`, {
                         method: 'DELETE' 
                        });
    
                    if (response.ok) {
                        // If deletion is successful, reload the page
                        window.location.reload();
                    } else {
                        console.error('Deletion failed');
                    }
                } catch (error) {
                    console.error('Error:', error);
                }
            } else {
                // If canceled, you can add a message or perform any other action
                console.log('Deletion canceled');
            }
        }



        //cancel order

        function cancelOrder(orderId, productId) {
    // Show a SweetAlert confirmation pop-up
    Swal.fire({
        title: 'Are you sure?',
        text: 'Do you want to cancel this order?',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#3085d6',
        cancelButtonColor: '#d33',
        confirmButtonText: 'Yes, cancel it!'
    }).then((result) => {
        if (result.isConfirmed) {
            // User clicked "Yes, cancel it!"
            fetch('/cancelorder', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ orderId, productId })
            })
            .then(response => {
                // Handle the response from the server
                if (response.ok) {
                    // If the cancellation was successful, show success alert
                    Swal.fire({
                        title: 'Cancelled!',
                        text: 'The order has been cancelled.',
                        icon: 'success'
                    }).then(() => {
                        // Reload the page after displaying success message
                        location.reload();
                    });
                } else {
                    // If cancellation failed, show an error alert
                    Swal.fire({
                        title: 'Error!',
                        text: 'Failed to cancel the order.',
                        icon: 'error'
                    });
                }
            })
            .catch(error => {
                // Handle fetch errors
                console.error('Fetch Error:', error);
                Swal.fire({
                    title: 'Error!',
                    text: 'Failed to cancel the order (Fetch Error).',
                    icon: 'error'
                });
            });
        }
    });
}



        //validation
   
        function validateField(fieldName) {
        var fieldValue = document.getElementById(fieldName).value;
        var errorElement = document.getElementById(fieldName + "Error");

        // Reset previous error message
        errorElement.innerHTML = "";

        // Add specific validation rules for each field
        switch (fieldName) {
            case 'firstName':
                if (fieldValue === "") {
                    errorElement.innerHTML = "First Name is required";
                }
                break;
            case 'lastName':
                if (fieldValue === "") {
                    errorElement.innerHTML = "Last Name is required";
                }
                break;
            case 'address':
                if (fieldValue === "") {
                    errorElement.innerHTML = "Address is required";
                }
                break;
            case 'phoneNumber':
                if (fieldValue === "") {
                    errorElement.innerHTML = "Phone Number is required";
                } else if (!/^\d+$/.test(fieldValue)) {
                    errorElement.innerHTML = "Phone Number must contain only digits";
                }
                break;
            case 'pincode':
                if (fieldValue === "") {
                    errorElement.innerHTML = "Pincode is required";
                } else if (!/^\d+$/.test(fieldValue)) {
                    errorElement.innerHTML = "Pincode must contain only digits";
                }
                break;
            case 'city':
                if (fieldValue === "") {
                    errorElement.innerHTML = "City/District is required";
                }
                break;
            case 'state':
                if (fieldValue === "") {
                    errorElement.innerHTML = "State is required";
                }
                break;
            // Add more cases for other fields if needed
        }
    }

    function validateForm() {
        // Call the validateField function for each field to update error messages
        validateField('firstName');
        validateField('lastName');
        validateField('address');
        validateField('phoneNumber');
        validateField('pincode');
        validateField('city');
        validateField('state');

        // Check if any error messages exist
        var errorMessages = document.querySelectorAll('.error');
        for (var i = 0; i < errorMessages.length; i++) {
            if (errorMessages[i].innerHTML !== "") {
                return false; // Prevent form submission if there are errors
            }
        }

        // If no errors, allow the form submission
        return true;
    }
</script>
<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <script>
        // Replace 'YOUR_RAZORPAY_KEY_ID' with your actual Razorpay key ID
        const razorpayKey = 'rzp_test_L29cGCMgVmLf64';

        // Function to handle form submission
        document.getElementById('add-money-btn').addEventListener('click', async function() {
        const amount = document.getElementById('add-money-input').value;

            try {
                // Create Razorpay order
                const response = await fetch('/add-money', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ amount }),
                });

                if (response.ok) {
                    const data = await response.json();
                    const orderId = data.orderId;

                    // Initialize Razorpay
                    const options = {
                        key: razorpayKey,
                        amount: data.order.amount,
                        currency: data.order.currency,
                        order_id: orderId,
                        name: 'Urban Charms',
                        image: 'https://razorpay.com/docs/build/browser/static/razorpay-docs-dark.6f09b030.svg',
                        description: 'Adding Money to Wallet',
                        handler: function (response) {
                            handleRazorpayPayment(response);
                        }
                    };

                    const rzp = new Razorpay(options);
                    rzp.open();
                } else {
                    console.log('Failed to create Razorpay order:', response.statusText);
                    // Handle the failure scenario
                }
            } catch (error) {
                console.error('Error:', error);
                // Handle the error scenario
            }
        });

        // Function to handle Razorpay payment response
        async function handleRazorpayPayment(response) {
            const data = {
               
                razorpayPaymentId: response.razorpay_payment_id,
                razorpayOrderId: response.razorpay_order_id,
                razorpaySignature: response.razorpay_signature,
            };
            try {
               
                // Send the payment response to the server for verification
                const verifyResponse = await fetch('/verify', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data),
                });

                if (verifyResponse.ok) {
                    const result = await verifyResponse.json();
                    if (result.success) {
                    
                        window.location.href = '/profile';
                        // Payment verification successful
                        swal({
                        title: "Transaction completed!!",
                        text: "Your top-up to the wallet was successful.",
                        icon: "success",
                    }).then(() => {
                      
                        window.location.href = '/profile';
                    });
                        // Redirect or show success message to user
                    } else {
                        // Payment verification failed
                        console.log('Payment verification failed:', result.message);
                        // Handle payment verification failure
                    }
                } else {
                    // Failed to verify payment
                    console.log('Failed to verify payment:', verifyResponse.statusText);
                    // Handle the failure scenario
                }
            } catch (error) {
                console.error('Error:', error);
                // Handle the error scenario
            }
        }
    </script>
    <!-- Plugins JS File -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="/assetsb/js/jquery.min.js"></script>
    <script src="/assetsb/js/bootstrap.bundle.min.js"></script>
    <script src="/assetsb/js/jquery.hoverIntent.min.js"></script>
    <script src="/assetsb/js/jquery.waypoints.min.js"></script>
    <script src="/assetsb/js/superfish.min.js"></script>
    <script src="/assetsb/js/owl.carousel.min.js"></script>
    <!-- Main JS File -->
    <script src="/assetsb/js/main.js"></script>
</body>


<!-- molla/dashboard.html  22 Nov 2019 10:03:13 GMT -->
</html>